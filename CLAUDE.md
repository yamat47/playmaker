# Claude Code メモ

## 重要な作業ルール

### コード変更後の必須チェック

コードを変更した後は、必ず以下のコマンドを実行してエラーがないことを確認する：

1. **型チェック**: `pnpm run typecheck`
2. **リント**: `pnpm run lint`
3. **テスト**: `pnpm run test --run`
4. **ビルド**: `pnpm run build`

**特に重要**: UI要素を変更・削除した場合は、必ずテストも更新すること。毎回テストを実行して失敗がないか確認する。

### CI/CD

- GitHub ActionsでCIが設定されており、以下が自動実行される：
  - ESLintによるコード品質チェック
  - Prettierによるコードフォーマットチェック
  - TypeScriptの型チェック
  - Vitestによるテスト実行
  - ビルドの成功確認
- mainブランチとviveブランチへのpush、およびmainブランチへのPRで自動実行

### パッケージマネージャー

- **pnpm** を使用すること（npmではない）

### コーディング規約

- **すべてのファイルの末尾に改行を入れること**
- **Prettierでコードフォーマットを統一すること**
  - `pnpm prettier --write "**/*.{js,jsx,ts,tsx,json,css,md}"` でフォーマット
  - pre-commitフックで自動フォーマットされる

### テスト駆動開発（TDD）

- **t-wadaのTDDアプローチに従って実装を進めること**
- 新機能の実装時は以下のサイクルを守る：
  1. **Red**: 失敗するテストを先に書く
  2. **Green**: テストを通す最小限の実装を行う
  3. **Refactor**: コードをリファクタリングして品質を向上させる
- テストファーストで考え、実装前に期待する振る舞いを明確にする
- 各機能に対して適切なユニットテストを書く

### 現在のプロジェクト

- アメリカンフットボールのプレイダイアグラムエディタ
- React + TypeScript + Vite + Tailwind CSS
- Canvas描画にはKonva.jsを使用予定（依存関係には追加済み）

### UIデザイン

- **Figmaスタイルのインターフェース**を採用
  - 左サイドバー：ツールバー（選択、プレイヤー配置、消しゴムなど）
  - 中央：キャンバス（フィールド）
  - 右サイドバー：プロパティパネル（選択した要素の詳細と操作）
- **選手をクリックすると右パネルに操作オプションが表示される**
  - ルート描画オプション（実線、破線、点線）
  - 位置情報
  - その他のプロパティ
- ツールの選択と要素の操作を明確に分離したデザイン

### Using MCP

実装中に技術的に詰まったところやわからないところ、解決できないエラーなどがあればo3 mcpに英語で相談して。

## リファクタリング実装ルール

### 基本方針

- **自動テストを必ず書く**: 新機能実装やリファクタリング時は、必ずテストを書いて品質を保証する
- **細かいコンポーネント分割**: 将来的なStorybook導入を見越して、再利用可能な小さなコンポーネントに分割する
- **TDD (Test-Driven Development)**: t-wadaのTDDアプローチに従い、Red → Green → Refactorのサイクルを守る
  1. **Red**: 失敗するテストを先に書く
  2. **Green**: テストを通す最小限の実装を行う
  3. **Refactor**: コードをリファクタリングして品質を向上させる
- **Linterの遵守**: プロジェクトに定義されているlinterルールを守り、毎回以下のコマンドで成功することを確認する
  - `pnpm run typecheck`
  - `pnpm run lint`
  - `pnpm run test --run`
  - `pnpm run build`

### リファクタリング手順

docs/refactoring-plan.mdに従って、以下の順序で実装を進める：

1. **型定義の統一** (types/index.tsの作成)
2. **Zustandストアの導入** (状態管理の整理)
3. **App.tsxの段階的分割** (PropertyPanel, LeftToolbar, Headerの切り出し)
4. **Field.tsxのヘルパー関数外出し** (utils/へ移動)
5. **Canvas描画ロジックの分離** (FieldRendererクラスの作成)
6. **テストの追加** (各コンポーネント・関数のテスト)

### 各ステップ完了時の確認事項

- [ ] TypeScriptエラーがゼロ
- [ ] Lintエラーがゼロ
- [ ] すべてのテストがパス
- [ ] ビルドが成功
- [ ] 既存機能が正常動作（プレイヤー追加・移動、ルート描画、選択・削除、プロパティパネル、エクスポート）

### コミット規約

- 1機能 = 1コミット
- 意味のある小さな単位でコミット
- ロールバックしやすい粒度を保つ
